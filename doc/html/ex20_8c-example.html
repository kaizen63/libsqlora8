<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libsqlora8: ex20.c</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>ex20.c</h1>Example for using sqlo_query_result.<p>
<div class="fragment"><pre class="fragment"><span class="comment">/* $Id: ex20.c 301 2005-01-08 17:28:49Z kpoitschke $ */</span>
<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include "examples.h"</span>

<span class="comment">/* Select employees with salary &gt; min_income using sqlo_query_result */</span>

<span class="keywordtype">int</span> ex20(sqlo_db_handle_t dbh, <span class="keywordtype">double</span> min_income)
{
  <a class="code" href="group__typedefs.html#ga1">sqlo_stmt_handle_t</a> sth;       <span class="comment">/* statement handle */</span>
  <span class="keywordtype">int</span> status;                   <span class="comment">/* status of sqlo calls */</span>
  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i,j;                      <span class="comment">/* loop counter */</span>
  <span class="keywordtype">char</span> ** v;                    <span class="comment">/* values */</span>
  <span class="keywordtype">char</span> ** col_names;           <span class="comment">/* column names */</span>
  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *nl;            <span class="comment">/* column name lengths */</span>
  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *vl;           <span class="comment">/* value lengths */</span>
  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nc;              <span class="comment">/* number of columns */</span>
  <span class="keywordtype">int</span> nrows;

  sth = reopen_cursor(dbh, min_income); <span class="comment">/* see example of sqlo_reopen (ex6.c) */</span>


  printf(<span class="stringliteral">"Employees with SAL &gt; %-8.2f:\n"</span>, min_income);


  nrows = 0;
  <span class="comment">/* fetch the data */</span>
  <span class="keywordflow">while</span> ( SQLO_SUCCESS == (status = (<a name="a51"></a><a class="code" href="group__easy.html#ga13">sqlo_query_result</a>(sth, <span class="comment">/* statement */</span>
                               &amp;nc, <span class="comment">/* number of columns */</span>
                               &amp;v,  <span class="comment">/* values */</span>
                               &amp;vl, <span class="comment">/* value lengths */</span>
                               &amp;col_names, <span class="comment">/* column names */</span>
                               &amp;nl   <span class="comment">/* column name lengths */</span>
                               )))) {
    
    <span class="keywordflow">if</span> ( nrows == 0 )
      {
    <span class="comment">/* print the header */</span>
    <span class="keywordflow">for</span> (i = 0; i &lt; nc; ++i)
      printf("%-*s ", nl[i]+4, col_names[i]);
    printf("\n");
    for (i = 0; i &lt; nc; ++i) {
      <span class="keywordflow">for</span> (j = 0; j &lt; nl[i]+4; ++j) {
        putchar(<span class="charliteral">'-'</span>);
      }
      putchar(<span class="charliteral">'+'</span>);
    }
    putchar(<span class="charliteral">'\n'</span>);
      }
    
    <span class="comment">/* print the column values */</span>
    <span class="keywordflow">for</span> (i = 0; i &lt; nc; ++i)
      printf("%-*s ", (vl[i] &gt; nl[i] ? vl[i] : nl[i])+4, v[i]);
    
    printf("\n");

    ++nrows;
  }

  if (0 &gt; status) {
    error_exit(dbh, <span class="stringliteral">"sqlo_query_result"</span>);
  }

  <span class="keywordflow">if</span> ( SQLO_SUCCESS != <a name="a52"></a><a class="code" href="group__easy.html#ga15">sqlo_close</a>(sth))
    error_exit(dbh, "sqlo_close");

  return 1;

}

<span class="comment">/* $Id: ex20.c 301 2005-01-08 17:28:49Z kpoitschke $ */</span>
   
</pre></div> <hr size="1"><address style="align: right;"><small>Generated on Fri Nov 4 16:19:04 2005 for libsqlora8 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.1 </small></address>
</body>
</html>
