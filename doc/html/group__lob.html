<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libsqlora8: Functions to insert/select LOBs</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>Functions to insert/select LOBs</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lob.html#ga0">sqlo_alloc_lob_desc</a> (<a class="el" href="group__typedefs.html#ga0">sqlo_db_handle_t</a> dbh, <a class="el" href="group__typedefs.html#ga2">sqlo_lob_desc_t</a> *loblpp)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Allocate a lob descriptor.  <a href="#ga0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lob.html#ga1">sqlo_free_lob_desc</a> (<a class="el" href="group__typedefs.html#ga0">sqlo_db_handle_t</a> dbh, <a class="el" href="group__typedefs.html#ga2">sqlo_lob_desc_t</a> *loblpp)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free a lob descriptor.  <a href="#ga1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lob.html#ga2">sqlo_lob_write_buffer</a> (<a class="el" href="group__typedefs.html#ga0">sqlo_db_handle_t</a> dbh, <a class="el" href="group__typedefs.html#ga2">sqlo_lob_desc_t</a> loblp, unsigned int loblen, void *bufp, unsigned int bufl, unsigned int piece)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write lob data from buffer into the lob column.  <a href="#ga2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lob.html#ga3">sqlo_lob_append_buffer</a> (<a class="el" href="group__typedefs.html#ga0">sqlo_db_handle_t</a> dbh, <a class="el" href="group__typedefs.html#ga2">sqlo_lob_desc_t</a> loblp, unsigned int loblen, void *bufp, unsigned int bufl, unsigned int piece)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Append lob data from buffer to the lob column.  <a href="#ga3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lob.html#ga4">sqlo_lob_write_stream</a> (<a class="el" href="group__typedefs.html#ga0">sqlo_db_handle_t</a> dbh, <a class="el" href="group__typedefs.html#ga2">sqlo_lob_desc_t</a> loblp, unsigned int filelen, FILE *fp)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write lob data from a file into the lob column.  <a href="#ga4"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lob.html#ga5">sqlo_lob_get_length</a> (<a class="el" href="group__typedefs.html#ga0">sqlo_db_handle_t</a> dbh, <a class="el" href="group__typedefs.html#ga2">sqlo_lob_desc_t</a> loblp, unsigned int *loblenp)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the length of a lob.  <a href="#ga5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lob.html#ga6">sqlo_lob_read_buffer</a> (<a class="el" href="group__typedefs.html#ga0">sqlo_db_handle_t</a> dbh, <a class="el" href="group__typedefs.html#ga2">sqlo_lob_desc_t</a> loblp, unsigned int loblen, void *bufp, unsigned int bufl)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read lob data from lob column into a buffer.  <a href="#ga6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lob.html#ga7">sqlo_lob_read_stream</a> (<a class="el" href="group__typedefs.html#ga0">sqlo_db_handle_t</a> dbh, <a class="el" href="group__typedefs.html#ga2">sqlo_lob_desc_t</a> loblp, unsigned int loblen, FILE *fp)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read lob data from lob column into a stream.  <a href="#ga7"></a><br></td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="ga0" doxytag="sqlora.h::sqlo_alloc_lob_desc"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int sqlo_alloc_lob_desc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="group__typedefs.html#ga0">sqlo_db_handle_t</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dbh</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="group__typedefs.html#ga2">sqlo_lob_desc_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>loblpp</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Allocate a lob descriptor. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dbh</em>&nbsp;</td><td>I - A database handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>loblpp</em>&nbsp;</td><td>O - The lob locator</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>SQLO_SUCCESS or &lt; 0 on error </dd></dl>
<dl compact><dt><b>Since:</b></dt><dd>Version 2.2 </dd></dl>
<dl compact><dt><b>Examples: </b></dt><dd>
<a class="el" href="ex15_8c-example.html#a20">ex15.c</a>.</dl>    </td>
  </tr>
</table>
<a class="anchor" name="ga1" doxytag="sqlora.h::sqlo_free_lob_desc"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int sqlo_free_lob_desc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="group__typedefs.html#ga0">sqlo_db_handle_t</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dbh</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="group__typedefs.html#ga2">sqlo_lob_desc_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>loblpp</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Free a lob descriptor. 
<p>
Frees the descriptor and sets *loblp to NULL.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dbh</em>&nbsp;</td><td>I - A database handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>loblpp</em>&nbsp;</td><td>I/O - A address where we find the lob locator.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><ul>
<li>
SQLO_SUCCESS </li>
<li>
&lt; 0 on error </li>
</ul>
</dd></dl>
<dl compact><dt><b>Since:</b></dt><dd>Version 2.2 </dd></dl>
<dl compact><dt><b>Examples: </b></dt><dd>
<a class="el" href="ex13_8c-example.html#a9">ex13.c</a>, <a class="el" href="ex14_8c-example.html#a15">ex14.c</a>, <a class="el" href="ex15_8c-example.html#a21">ex15.c</a>, and <a class="el" href="ex16_8c-example.html#a28">ex16.c</a>.</dl>    </td>
  </tr>
</table>
<a class="anchor" name="ga3" doxytag="sqlora.h::sqlo_lob_append_buffer"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int sqlo_lob_append_buffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="group__typedefs.html#ga0">sqlo_db_handle_t</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dbh</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="group__typedefs.html#ga2">sqlo_lob_desc_t</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>loblp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int&nbsp;</td>
          <td class="mdname" nowrap> <em>loblen</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>bufp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int&nbsp;</td>
          <td class="mdname" nowrap> <em>bufl</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int&nbsp;</td>
          <td class="mdname" nowrap> <em>piece</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Append lob data from buffer to the lob column. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dbh</em>&nbsp;</td><td>I - A database handle. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>loblen</em>&nbsp;</td><td>I - The length of the lob. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>loblp</em>&nbsp;</td><td>I - A lob locator. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>bufp</em>&nbsp;</td><td>I - A buffer of data. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>bufl</em>&nbsp;</td><td>I - The length of the buffer in terms of bytes. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>piece</em>&nbsp;</td><td>I - The piece indicator <ul>
<li>
SQLO_ONE_PIECE </li>
<li>
SQLO_FIRST_PIECE </li>
<li>
SQLO_NEXT_PIECE </li>
<li>
SQLO_LAST_PIECE </li>
</ul>
</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><ul>
<li>
SQLO_SUCCESS </li>
<li>
SQLO_STILL_EXECUTING </li>
<li>
SQLO_ERROR (always when OCILobWriteAppend is not available in your Oracle version) </li>
</ul>
</dd></dl>
<dl compact><dt><b>Since:</b></dt><dd>Version 2.2 and Oracle version &gt;= 8.1 </dd></dl>
<dl compact><dt><b>Example:</b></dt><dd><div class="fragment"><pre class="fragment"><span class="comment">/* $Id: ex13.c 286 2004-06-15 10:15:52Z kpoitschke $ */</span>
<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include "examples.h"</span>


<span class="keywordtype">int</span> insert_into_blob_table(sqlo_db_handle_t dbh, <span class="keywordtype">int</span> key )
{
  <span class="keywordtype">char</span> * stmt = 
    <span class="stringliteral">"INSERT INTO T_SQLORA_BLOB (KEY, CDATA) "</span>
    <span class="stringliteral">"VALUES (:b1, EMPTY_CLOB()) RETURNING CDATA INTO :b2"</span>;

  <span class="keywordtype">char</span> data[MAX_BLOB_BUFFER_DATA];        <span class="comment">/* a data buffer */</span>
  <a class="code" href="group__typedefs.html#ga2">sqlo_lob_desc_t</a> loblp;                  <span class="comment">/* the lob locator */</span>
  <a class="code" href="group__typedefs.html#ga1">sqlo_stmt_handle_t</a> sth;
  <span class="keywordtype">int</span> status;
  <span class="keywordtype">int</span> k = key;

  printf(<span class="stringliteral">"Insert CLOB\n"</span>);

  <span class="comment">/* create the test table */</span>
  create_blob_table(dbh);

  <span class="comment">/* fill the data buffer with some characters */</span>
  fillbuf(data, MAX_BLOB_BUFFER_DATA);

  <span class="comment">/* parse the statement */</span>

  <span class="keywordflow">if</span> (0&gt;(sth = <a class="code" href="group__complex.html#ga0">sqlo_prepare</a>(dbh, stmt)))
    error_exit(dbh, "sqlo_prepare");

  <span class="comment">/* alloate the lob descriptor */</span>
  if (0 &gt; sqlo_alloc_lob_desc(dbh, &amp;loblp))
    error_exit(dbh, "sqlo_alloc_lob_desc");

  <span class="comment">/* bind input variables. Note: we bind the lob descriptor here */</span>
  if (SQLO_SUCCESS != 
      (sqlo_bind_by_pos(sth, 1, SQLOT_INT, &amp;k, sizeof(<span class="keywordtype">int</span>), NULL, 0)) ||
      (sqlo_bind_by_pos(sth, 2, SQLOT_CLOB, &amp;loblp, 0, NULL, 0))
      ) {
    <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
    error_exit(dbh, <span class="stringliteral">"sqlo_bind_by_pos"</span>);
  }

  <span class="comment">/* execute the statement */</span>
  status = <a class="code" href="group__complex.html#ga8">sqlo_execute</a>(sth, 1);

  <span class="keywordflow">if</span> (SQLO_SUCCESS != status) {
    <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
    error_exit(dbh, <span class="stringliteral">"sqlo_execute"</span>);
  }

  <span class="comment">/* write the lob */</span>
  status = <a class="code" href="group__lob.html#ga2">sqlo_lob_write_buffer</a>(dbh, loblp, MAX_BLOB_BUFFER_DATA, data, 
                                 MAX_BLOB_BUFFER_DATA, SQLO_ONE_PIECE);

  <span class="keywordflow">if</span> (status &lt; 0) {
    <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
    error_exit(dbh, <span class="stringliteral">"sqlo_log_write_buffer"</span>);
  }

  <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
  <a class="code" href="group__easy.html#ga15">sqlo_close</a>(sth);
  
  <span class="keywordflow">return</span> (1);
}

<span class="keywordtype">void</span> create_blob_table(sqlo_db_handle_t dbh)
{
  <span class="keywordtype">char</span> * stmt=
    <span class="stringliteral">"CREATE TABLE T_SQLORA_BLOB (KEY INTEGER, CDATA CLOB, BDATA BLOB)"</span>;

  <span class="keywordflow">if</span> (SQLO_SUCCESS != <a class="code" href="group__easy.html#ga16">sqlo_exec</a>(dbh, stmt))
    if (sqlo_geterrcode(dbh) != 955) <span class="comment">/* table exists already */</span>
      error_exit(dbh, "sqlo_exec");
}

<span class="keywordtype">void</span> drop_blob_table(sqlo_db_handle_t dbh)
{
  <span class="keywordtype">char</span> * stmt = <span class="stringliteral">"DROP TABLE T_SQLORA_BLOB"</span>;

  <span class="keywordflow">if</span> (SQLO_SUCCESS != <a class="code" href="group__easy.html#ga16">sqlo_exec</a>(dbh, stmt))
    error_exit(dbh, "sqlo_exec");
}

<span class="keywordtype">void</span> fillbuf(<span class="keywordtype">char</span> * data, <span class="keywordtype">int</span> len)
{
  <span class="keywordtype">int</span> i;
  <span class="keywordflow">for</span> (i = 0; i &lt; len; ++i) {
    data[i] = <span class="charliteral">'A'</span> + i % 26;
  }
}

<span class="comment">/* $Id: ex13.c 286 2004-06-15 10:15:52Z kpoitschke $ */</span>
</pre></div> </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga5" doxytag="sqlora.h::sqlo_lob_get_length"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int sqlo_lob_get_length           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="group__typedefs.html#ga0">sqlo_db_handle_t</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dbh</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="group__typedefs.html#ga2">sqlo_lob_desc_t</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>loblp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int *&nbsp;</td>
          <td class="mdname" nowrap> <em>loblenp</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get the length of a lob. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dbh</em>&nbsp;</td><td>I - Database handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>loblp</em>&nbsp;</td><td>I - A lob descriptor </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>loblenp</em>&nbsp;</td><td>O - The length of the lob</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><ul>
<li>
SQLO_SUCCESS </li>
<li>
SQLO_STILL_EXECUTING </li>
<li>
SQLO_ERROR </li>
</ul>
</dd></dl>
<dl compact><dt><b>Examples: </b></dt><dd>
<a class="el" href="ex15_8c-example.html#a23">ex15.c</a>, and <a class="el" href="ex16_8c-example.html#a30">ex16.c</a>.</dl>    </td>
  </tr>
</table>
<a class="anchor" name="ga6" doxytag="sqlora.h::sqlo_lob_read_buffer"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int sqlo_lob_read_buffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="group__typedefs.html#ga0">sqlo_db_handle_t</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dbh</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="group__typedefs.html#ga2">sqlo_lob_desc_t</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>loblp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int&nbsp;</td>
          <td class="mdname" nowrap> <em>loblen</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>bufp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int&nbsp;</td>
          <td class="mdname" nowrap> <em>bufl</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Read lob data from lob column into a buffer. 
<p>
Reads data from the lob and writes it into the supplied buffer.<p>
Use <a class="el" href="group__lob.html#ga5">sqlo_lob_get_length</a> to get the loblen you have to use here.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dbh</em>&nbsp;</td><td>I - A database handle. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>loblp</em>&nbsp;</td><td>I - A lob locator. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>loblen</em>&nbsp;</td><td>I - The length of the lob </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>bufp</em>&nbsp;</td><td>O - The output data. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>bufl</em>&nbsp;</td><td>I - The capacity of the buffer in terms of bytes.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><ul>
<li>
SQLO_SUCCESS </li>
<li>
SQLO_NEED_DATA </li>
<li>
SQLO_STILL_EXECUTING </li>
<li>
SQLO_ERROR </li>
</ul>
</dd></dl>
<dl compact><dt><b>Since:</b></dt><dd>Version 2.2 </dd></dl>
<dl compact><dt><b>Example:</b></dt><dd><div class="fragment"><pre class="fragment"><span class="comment">/* $Id: ex15.c 286 2004-06-15 10:15:52Z kpoitschke $ */</span>
<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &lt;string.h&gt;</span>
<span class="preprocessor">#include "examples.h"</span>

<span class="keywordtype">int</span> select_from_blob_table(sqlo_db_handle_t dbh, <span class="keywordtype">int</span> key )
{
  <span class="keywordtype">char</span> * stmt = 
    <span class="stringliteral">"SELECT KEY, CDATA FROM T_SQLORA_BLOB WHERE KEY = :1"</span>;
  <span class="keywordtype">int</span> status;
  <a class="code" href="group__typedefs.html#ga1">sqlo_stmt_handle_t</a> sth = <a class="code" href="group__constants.html#gga5a52">SQLO_STH_INIT</a>;
  <span class="keywordtype">int</span> k = key;
  <span class="keywordtype">char</span> * data;
  <span class="keywordtype">short</span> ind;
  <span class="keywordtype">char</span> cmp_data[MAX_BLOB_BUFFER_DATA];        <span class="comment">/* our buffer to compare the result */</span>
  <a class="code" href="group__typedefs.html#ga2">sqlo_lob_desc_t</a> loblp;
  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> loblen;

  printf(<span class="stringliteral">"Query CLOB\n"</span>);

  fillbuf2(cmp_data, MAX_BLOB_BUFFER_DATA); <span class="comment">/* our reference data */</span>

  <span class="comment">/* parse */</span>
  <span class="keywordflow">if</span> (0 &gt; (sth = <a class="code" href="group__complex.html#ga0">sqlo_prepare</a>(dbh, stmt)))
    error_exit(dbh, "sqlo_prepare");

  <span class="comment">/* bind input */</span>
  if (SQLO_SUCCESS != 
      (sqlo_bind_by_pos(sth, 1, SQLOT_INT, &amp;k, sizeof(k), 0, 0))) {
      error_exit(dbh, <span class="stringliteral">"sqlo_bind_by_pos"</span>);
    }
      
  <span class="comment">/* allocate a lob descriptor */</span>
  <span class="keywordflow">if</span> (0 &gt; <a class="code" href="group__lob.html#ga0">sqlo_alloc_lob_desc</a>(dbh, &amp;loblp))
    error_exit(dbh, "sqlo_alloc_lob_desc");

  <span class="comment">/* define output */</span>
  if (SQLO_SUCCESS != 
      (sqlo_define_by_pos(sth, 1, SQLOT_INT, &amp;k, sizeof(k), 0, 0, 0)) ||
      (sqlo_define_by_pos(sth, 2, SQLOT_CLOB, &amp;loblp, 0, &amp;ind, 0, 0))) {

      <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
      error_exit(dbh, <span class="stringliteral">"sqlo_define_by_pos2"</span>);
    }      

  <span class="comment">/* execute */</span>
  status = <a class="code" href="group__complex.html#ga8">sqlo_execute</a>(sth, 1);

  <span class="keywordflow">if</span> (SQLO_SUCCESS != status)  {
    <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
    error_exit(dbh, <span class="stringliteral">"sqlo_execute"</span>);
  }

  <span class="keywordflow">if</span> (ind != SQLO_NULL_IND) 
    {
      status = <a class="code" href="group__lob.html#ga5">sqlo_lob_get_length</a>(dbh, loblp, &amp;loblen);

      <span class="keywordflow">if</span> ( 0 &gt; status) {
        <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
        error_exit(dbh, <span class="stringliteral">"sqlo_free_lob_desc"</span>);
      }

      <span class="keywordflow">if</span> (loblen != MAX_BLOB_BUFFER_DATA) {
        printf(<span class="stringliteral">"Invalid LOB size. Expected %d, got %d\n"</span>, MAX_BLOB_BUFFER_DATA,
               loblen);
        <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
        <a class="code" href="group__easy.html#ga15">sqlo_close</a>(sth);
        <span class="keywordflow">return</span> 0;
      }

      <span class="comment">/* allocate the buffer for the data */</span>
      data = malloc(loblen * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
      <span class="keywordflow">if</span> (!data) {
          printf(<span class="stringliteral">"FATAL: malloc error at %d\n"</span>, __LINE__);
          <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
          exit(EXIT_FAILURE);
      }

      <span class="comment">/* read the data into the buffer */</span>
      status = <a class="code" href="group__lob.html#ga6">sqlo_lob_read_buffer</a>(dbh, loblp, loblen, data, loblen);

      <span class="keywordflow">if</span> ( 0 &gt; status)  {
          printf(<span class="stringliteral">"sqlo_lob_read_buffer failed: %s\n"</span>, <a class="code" href="group__error.html#ga0">sqlo_geterror</a>(dbh) );
          <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
          error_exit(dbh, <span class="stringliteral">"sqlo_lob_read_buffer"</span>);
        }

      printf(<span class="stringliteral">"Compare CLOB\n"</span>);
      <span class="comment">/* compare with our reference data */</span>
      <span class="keywordflow">if</span> (memcmp(data, &amp;cmp_data, MAX_BLOB_BUFFER_DATA)) {
        <span class="keywordtype">int</span> i;
        printf(<span class="stringliteral">"LOB read is different from LOB written\n"</span>);
        <span class="keywordflow">for</span> (i = 0; i &lt;= MAX_BLOB_BUFFER_DATA; ++i) {
          <span class="keywordflow">if</span> (data[i] != cmp_data[i])
            printf(<span class="stringliteral">"diff at pos %d\n"</span>, i);
        }
      }

      <span class="keywordflow">if</span> (data)
    free(data);
      data = NULL;
    } else {
      printf(<span class="stringliteral">"LOB is NULL\n"</span>);
      <span class="keywordflow">return</span> 0;
    }

  <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
  <a class="code" href="group__easy.html#ga15">sqlo_close</a>(sth);

  <span class="keywordflow">return</span> (1);

}

<span class="comment">/* $Id: ex15.c 286 2004-06-15 10:15:52Z kpoitschke $ */</span>
</pre></div> </dd></dl>
<dl compact><dt><b>Examples: </b></dt><dd>
<a class="el" href="ex15_8c-example.html#a25">ex15.c</a>.</dl>    </td>
  </tr>
</table>
<a class="anchor" name="ga7" doxytag="sqlora.h::sqlo_lob_read_stream"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int sqlo_lob_read_stream           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="group__typedefs.html#ga0">sqlo_db_handle_t</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dbh</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="group__typedefs.html#ga2">sqlo_lob_desc_t</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>loblp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int&nbsp;</td>
          <td class="mdname" nowrap> <em>loblen</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>FILE *&nbsp;</td>
          <td class="mdname" nowrap> <em>fp</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Read lob data from lob column into a stream. 
<p>
Use <a class="el" href="group__lob.html#ga5">sqlo_lob_get_length</a> to get the loblen you have to use here.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dbh</em>&nbsp;</td><td>I - A database handle. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>loblp</em>&nbsp;</td><td>I - A lob locator. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>loblen</em>&nbsp;</td><td>I - The length of the lob </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fp</em>&nbsp;</td><td>I - A filepointer</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><ul>
<li>
SQLO_SUCCESS </li>
<li>
SQLO_STILL_EXECUTING </li>
<li>
SQLO_ERROR </li>
</ul>
</dd></dl>
<dl compact><dt><b>Since:</b></dt><dd>Version 2.2</dd></dl>
<dl compact><dt><b>Example:</b></dt><dd><div class="fragment"><pre class="fragment"><span class="comment">/* $Id: ex16.c 286 2004-06-15 10:15:52Z kpoitschke $ */</span>
<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include "examples.h"</span>

<span class="keywordtype">int</span> select_file_from_blob_table(sqlo_db_handle_t dbh, <span class="keywordtype">int</span> key, <span class="keyword">const</span> <span class="keywordtype">char</span> *fname )
{
  <span class="keywordtype">char</span> * stmt = 
    <span class="stringliteral">"SELECT KEY, BDATA FROM T_SQLORA_BLOB WHERE KEY = :1"</span>;
  <span class="keywordtype">int</span> status;
  <a class="code" href="group__typedefs.html#ga1">sqlo_stmt_handle_t</a> sth = <a class="code" href="group__constants.html#gga5a52">SQLO_STH_INIT</a>;
  <span class="keywordtype">int</span> k = key;
  FILE * fp;
  <a class="code" href="group__typedefs.html#ga2">sqlo_lob_desc_t</a> loblp;
  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> loblen;
  <span class="keywordtype">short</span> ind;

  <span class="keywordflow">if</span> (!(fp = fopen(fname, <span class="stringliteral">"w"</span>))) {
    printf(<span class="stringliteral">"ERROR: Cannot open %s for write\n"</span>, fname);
    <span class="keywordflow">return</span> 0;
  }

  <span class="comment">/* parse */</span>
  <span class="keywordflow">if</span> (0 &gt; (sth = <a class="code" href="group__complex.html#ga0">sqlo_prepare</a>(dbh, stmt)))
    error_exit(dbh, "sqlo_prepare");

  <span class="comment">/* bind input */</span>
  if (SQLO_SUCCESS != 
      (sqlo_bind_by_pos(sth, 1, SQLOT_INT, &amp;k, sizeof(k), 0, 0)))
    error_exit(dbh, "sqlo_bind_by_pos");

  <span class="comment">/* alloc lob desc */</span>
  if (SQLO_SUCCESS !=  sqlo_alloc_lob_desc(dbh, &amp;loblp))
    error_exit(dbh, "sqlo_alloc_lob_desc");

  <span class="comment">/* define output */</span>
  if (SQLO_SUCCESS != 
      (sqlo_define_by_pos(sth, 1, SQLOT_INT, &amp;k, sizeof(k), 0, 0, 0)) ||
      (sqlo_define_by_pos(sth, 2, SQLOT_BLOB, &amp;loblp, 0, &amp;ind, 0, 0))) {
    <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
    error_exit(dbh, <span class="stringliteral">"sqlo_define_by_pos2"</span>);
  }      

  <span class="comment">/* execute */</span>
  status = <a class="code" href="group__complex.html#ga8">sqlo_execute</a>(sth, 1);

  <span class="keywordflow">if</span> ( 0 &gt; status) {
    <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
    error_exit(dbh, <span class="stringliteral">"sqlo_execute"</span>);
  }

  <span class="comment">/* get the LOB length */</span>
  status = <a class="code" href="group__lob.html#ga5">sqlo_lob_get_length</a>(dbh, loblp, &amp;loblen);

  <span class="keywordflow">if</span> ( 0 &gt; status) {
    <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
    error_exit(dbh, <span class="stringliteral">"sqlo_log_get_length"</span>);
  }

  <span class="comment">/* write it to the file */</span>
  status = <a class="code" href="group__lob.html#ga7">sqlo_lob_read_stream</a>(dbh, loblp, loblen, fp);

  <span class="keywordflow">if</span> ( 0 &gt; status) {
    <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
    <a class="code" href="group__easy.html#ga15">sqlo_close</a>(sth);
    error_exit(dbh, <span class="stringliteral">"sqlo_lob_read_stream"</span>);
  }

  fclose(fp);

  <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
  <a class="code" href="group__easy.html#ga15">sqlo_close</a>(sth);

  <a class="code" href="group__transactions.html#ga1">sqlo_rollback</a>(dbh);
  drop_blob_table(dbh);

  <span class="keywordflow">return</span> (1);

}

<span class="comment">/* $Id: ex16.c 286 2004-06-15 10:15:52Z kpoitschke $ */</span>
</pre></div></dd></dl>
<dl compact><dt><b>See also:</b></dt><dd><a class="el" href="group__lob.html#ga6">sqlo_lob_read_buffer</a> </dd></dl>
<dl compact><dt><b>Examples: </b></dt><dd>
<a class="el" href="ex16_8c-example.html#a31">ex16.c</a>.</dl>    </td>
  </tr>
</table>
<a class="anchor" name="ga2" doxytag="sqlora.h::sqlo_lob_write_buffer"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int sqlo_lob_write_buffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="group__typedefs.html#ga0">sqlo_db_handle_t</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dbh</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="group__typedefs.html#ga2">sqlo_lob_desc_t</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>loblp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int&nbsp;</td>
          <td class="mdname" nowrap> <em>loblen</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>bufp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int&nbsp;</td>
          <td class="mdname" nowrap> <em>bufl</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int&nbsp;</td>
          <td class="mdname" nowrap> <em>piece</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Write lob data from buffer into the lob column. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dbh</em>&nbsp;</td><td>I - A database handle. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>loblen</em>&nbsp;</td><td>I - The length of the lob. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>loblp</em>&nbsp;</td><td>I - A lob locator. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>bufp</em>&nbsp;</td><td>I - A buffer of data. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>bufl</em>&nbsp;</td><td>I - The length of the buffer in terms of bytes. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>piece</em>&nbsp;</td><td>I - The piece indicator <ul>
<li>
SQLO_ONE_PIECE </li>
<li>
SQLO_FIRST_PIECE </li>
<li>
SQLO_NEXT_PIECE </li>
<li>
SQLO_LAST_PIECE </li>
</ul>
</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><ul>
<li>
SQLO_SUCCESS </li>
<li>
SQLO_STILL_EXECUTING </li>
<li>
SQLO_ERROR </li>
</ul>
</dd></dl>
<dl compact><dt><b>Since:</b></dt><dd>Version 2.2 </dd></dl>
<dl compact><dt><b>Example:</b></dt><dd><div class="fragment"><pre class="fragment"><span class="comment">/* $Id: ex13.c 286 2004-06-15 10:15:52Z kpoitschke $ */</span>
<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include "examples.h"</span>


<span class="keywordtype">int</span> insert_into_blob_table(sqlo_db_handle_t dbh, <span class="keywordtype">int</span> key )
{
  <span class="keywordtype">char</span> * stmt = 
    <span class="stringliteral">"INSERT INTO T_SQLORA_BLOB (KEY, CDATA) "</span>
    <span class="stringliteral">"VALUES (:b1, EMPTY_CLOB()) RETURNING CDATA INTO :b2"</span>;

  <span class="keywordtype">char</span> data[MAX_BLOB_BUFFER_DATA];        <span class="comment">/* a data buffer */</span>
  <a class="code" href="group__typedefs.html#ga2">sqlo_lob_desc_t</a> loblp;                  <span class="comment">/* the lob locator */</span>
  <a class="code" href="group__typedefs.html#ga1">sqlo_stmt_handle_t</a> sth;
  <span class="keywordtype">int</span> status;
  <span class="keywordtype">int</span> k = key;

  printf(<span class="stringliteral">"Insert CLOB\n"</span>);

  <span class="comment">/* create the test table */</span>
  create_blob_table(dbh);

  <span class="comment">/* fill the data buffer with some characters */</span>
  fillbuf(data, MAX_BLOB_BUFFER_DATA);

  <span class="comment">/* parse the statement */</span>

  <span class="keywordflow">if</span> (0&gt;(sth = <a class="code" href="group__complex.html#ga0">sqlo_prepare</a>(dbh, stmt)))
    error_exit(dbh, "sqlo_prepare");

  <span class="comment">/* alloate the lob descriptor */</span>
  if (0 &gt; sqlo_alloc_lob_desc(dbh, &amp;loblp))
    error_exit(dbh, "sqlo_alloc_lob_desc");

  <span class="comment">/* bind input variables. Note: we bind the lob descriptor here */</span>
  if (SQLO_SUCCESS != 
      (sqlo_bind_by_pos(sth, 1, SQLOT_INT, &amp;k, sizeof(<span class="keywordtype">int</span>), NULL, 0)) ||
      (sqlo_bind_by_pos(sth, 2, SQLOT_CLOB, &amp;loblp, 0, NULL, 0))
      ) {
    <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
    error_exit(dbh, <span class="stringliteral">"sqlo_bind_by_pos"</span>);
  }

  <span class="comment">/* execute the statement */</span>
  status = <a class="code" href="group__complex.html#ga8">sqlo_execute</a>(sth, 1);

  <span class="keywordflow">if</span> (SQLO_SUCCESS != status) {
    <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
    error_exit(dbh, <span class="stringliteral">"sqlo_execute"</span>);
  }

  <span class="comment">/* write the lob */</span>
  status = <a class="code" href="group__lob.html#ga2">sqlo_lob_write_buffer</a>(dbh, loblp, MAX_BLOB_BUFFER_DATA, data, 
                                 MAX_BLOB_BUFFER_DATA, SQLO_ONE_PIECE);

  <span class="keywordflow">if</span> (status &lt; 0) {
    <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
    error_exit(dbh, <span class="stringliteral">"sqlo_log_write_buffer"</span>);
  }

  <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
  <a class="code" href="group__easy.html#ga15">sqlo_close</a>(sth);
  
  <span class="keywordflow">return</span> (1);
}

<span class="keywordtype">void</span> create_blob_table(sqlo_db_handle_t dbh)
{
  <span class="keywordtype">char</span> * stmt=
    <span class="stringliteral">"CREATE TABLE T_SQLORA_BLOB (KEY INTEGER, CDATA CLOB, BDATA BLOB)"</span>;

  <span class="keywordflow">if</span> (SQLO_SUCCESS != <a class="code" href="group__easy.html#ga16">sqlo_exec</a>(dbh, stmt))
    if (sqlo_geterrcode(dbh) != 955) <span class="comment">/* table exists already */</span>
      error_exit(dbh, "sqlo_exec");
}

<span class="keywordtype">void</span> drop_blob_table(sqlo_db_handle_t dbh)
{
  <span class="keywordtype">char</span> * stmt = <span class="stringliteral">"DROP TABLE T_SQLORA_BLOB"</span>;

  <span class="keywordflow">if</span> (SQLO_SUCCESS != <a class="code" href="group__easy.html#ga16">sqlo_exec</a>(dbh, stmt))
    error_exit(dbh, "sqlo_exec");
}

<span class="keywordtype">void</span> fillbuf(<span class="keywordtype">char</span> * data, <span class="keywordtype">int</span> len)
{
  <span class="keywordtype">int</span> i;
  <span class="keywordflow">for</span> (i = 0; i &lt; len; ++i) {
    data[i] = <span class="charliteral">'A'</span> + i % 26;
  }
}

<span class="comment">/* $Id: ex13.c 286 2004-06-15 10:15:52Z kpoitschke $ */</span>
</pre></div> <div class="fragment"><pre class="fragment"><span class="comment">/* $Id: ex13b.c 286 2004-06-15 10:15:52Z kpoitschke $ */</span>
<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include "examples.h"</span>

<span class="keywordtype">int</span> update_blob_table(sqlo_db_handle_t dbh, <span class="keywordtype">int</span> key )
{
  <span class="keywordtype">char</span> * stmt = 
    <span class="stringliteral">"UPDATE T_SQLORA_BLOB SET CDATA = EMPTY_CLOB() WHERE KEY=:b1 "</span>
    <span class="stringliteral">"RETURNING CDATA INTO :b2"</span>;

  <span class="keywordtype">char</span> data[MAX_BLOB_BUFFER_DATA];        <span class="comment">/* a data buffer */</span>
  <a class="code" href="group__typedefs.html#ga2">sqlo_lob_desc_t</a> loblp;                  <span class="comment">/* the lob locator */</span>
  <a class="code" href="group__typedefs.html#ga1">sqlo_stmt_handle_t</a> sth;
  <span class="keywordtype">int</span> status;
  <span class="keywordtype">int</span> k = key;

  printf(<span class="stringliteral">"Update CLOB\n"</span>);

  <span class="comment">/* fill the data buffer with some characters */</span>
  fillbuf2(data, MAX_BLOB_BUFFER_DATA);

  <span class="comment">/* parse the statement */</span>

  <span class="keywordflow">if</span> (0&gt;(sth = <a class="code" href="group__complex.html#ga0">sqlo_prepare</a>(dbh, stmt)))
    error_exit(dbh, "sqlo_prepare");

  <span class="comment">/* alloate the lob descriptor */</span>
  if (0 &gt; sqlo_alloc_lob_desc(dbh, &amp;loblp))
    error_exit(dbh, "sqlo_alloc_lob_desc");

  <span class="comment">/* bind input variables. Note: we bind the lob descriptor here */</span>
  if (SQLO_SUCCESS != 
      (sqlo_bind_by_pos(sth, 1, SQLOT_INT, &amp;k, sizeof(<span class="keywordtype">int</span>), NULL, 0)) ||
      (sqlo_bind_by_pos(sth, 2, SQLOT_CLOB, &amp;loblp, 0, NULL, 0))
      ) {
    <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
    error_exit(dbh, <span class="stringliteral">"sqlo_bind_by_pos"</span>);
  }

  <span class="comment">/* execute the statement */</span>
  status = <a class="code" href="group__complex.html#ga8">sqlo_execute</a>(sth, 1);

  <span class="keywordflow">if</span> (SQLO_SUCCESS != status) {
    <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
    error_exit(dbh, <span class="stringliteral">"sqlo_execute"</span>);
  }

  <span class="comment">/* write the lob */</span>
  status = <a class="code" href="group__lob.html#ga2">sqlo_lob_write_buffer</a>(dbh, loblp, MAX_BLOB_BUFFER_DATA, data, 
                                 MAX_BLOB_BUFFER_DATA, SQLO_ONE_PIECE);

  <span class="keywordflow">if</span> (status &lt; 0) {
    <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
    error_exit(dbh, <span class="stringliteral">"sqlo_log_write_buffer"</span>);
  }

  <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
  <a class="code" href="group__easy.html#ga15">sqlo_close</a>(sth);
  
  <span class="keywordflow">return</span> (1);
}

<span class="keywordtype">void</span> fillbuf2(<span class="keywordtype">char</span> * data, <span class="keywordtype">int</span> len)
{
  <span class="keywordtype">int</span> i;
  <span class="keywordflow">for</span> (i = 0; i &lt; len; ++i) {
    data[i] = <span class="charliteral">'a'</span> + i % 26;
  }
}

<span class="comment">/* $Id: ex13b.c 286 2004-06-15 10:15:52Z kpoitschke $ */</span>
</pre></div> </dd></dl>
<dl compact><dt><b>Examples: </b></dt><dd>
<a class="el" href="ex13_8c-example.html#a11">ex13.c</a>.</dl>    </td>
  </tr>
</table>
<a class="anchor" name="ga4" doxytag="sqlora.h::sqlo_lob_write_stream"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int sqlo_lob_write_stream           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="group__typedefs.html#ga0">sqlo_db_handle_t</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dbh</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="group__typedefs.html#ga2">sqlo_lob_desc_t</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>loblp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int&nbsp;</td>
          <td class="mdname" nowrap> <em>filelen</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>FILE *&nbsp;</td>
          <td class="mdname" nowrap> <em>fp</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Write lob data from a file into the lob column. 
<p>
This function reads the data from the stream and writes it into the lob column via <a class="el" href="group__lob.html#ga2">sqlo_lob_write_buffer</a>.<p>
<dl compact><dt><b>Attention:</b></dt><dd>The function does not close or rewind the fp.</dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dbh</em>&nbsp;</td><td>I - A database handle. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>loblp</em>&nbsp;</td><td>I - A lob locator. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>filelen</em>&nbsp;</td><td>I - The size of the file (total lob length) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fp</em>&nbsp;</td><td>I - The filepointer</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><ul>
<li>
SQLO_SUCCESS </li>
<li>
SQLO_ERROR </li>
</ul>
</dd></dl>
<dl compact><dt><b>Since:</b></dt><dd>Version 2.2 </dd></dl>
<dl compact><dt><b>Example:</b></dt><dd><div class="fragment"><pre class="fragment"><span class="comment">/* $Id: ex14.c 286 2004-06-15 10:15:52Z kpoitschke $ */</span>
<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include "examples.h"</span>

<span class="keywordtype">int</span> insert_file_into_blob_table(sqlo_db_handle_t dbh, <span class="keywordtype">int</span> key, <span class="keyword">const</span> <span class="keywordtype">char</span> * fname )
{

  <span class="keywordtype">char</span> * stmt = 
    <span class="stringliteral">"INSERT INTO T_SQLORA_BLOB (KEY, BDATA) "</span>
    <span class="stringliteral">"VALUES (:b1, EMPTY_BLOB()) RETURNING BDATA INTO :b2"</span>;
  <a class="code" href="group__typedefs.html#ga2">sqlo_lob_desc_t</a> loblp;                  <span class="comment">/* the lob locator */</span>
  <a class="code" href="group__typedefs.html#ga1">sqlo_stmt_handle_t</a> sth;
  <span class="keywordtype">int</span> status;
  FILE * fp;
  <span class="keywordtype">unsigned</span> filelen;
  <span class="keywordtype">short</span> ind;
  <span class="keywordtype">int</span> k = key;

  create_blob_table(dbh);

  <span class="keywordflow">if</span> (! (fp = fopen(fname, <span class="stringliteral">"r"</span>))) {
    printf(<span class="stringliteral">"ERROR: cannot open file %s\n"</span>, fname);
    <span class="keywordflow">return</span> 0;
  }

  <span class="comment">/* determine file len */</span>
  fseek(fp, 0, SEEK_END);
  filelen = ftell(fp);
  fseek(fp, 0, 0);

  <span class="comment">/* parse */</span>
  <span class="keywordflow">if</span> (0&gt;(sth = <a class="code" href="group__complex.html#ga0">sqlo_prepare</a>(dbh, stmt)))
    error_exit(dbh, "sqlo_prepare");

  <span class="comment">/* allocate the lob locator */</span>
  if (0 &gt; sqlo_alloc_lob_desc(dbh, &amp;loblp))
    error_exit(dbh, "sqlo_alloc_lob_desc");

  <span class="comment">/* bind input variables */</span>
  if (SQLO_SUCCESS != 
      (sqlo_bind_by_pos(sth, 1, SQLOT_INT, &amp;k, sizeof(<span class="keywordtype">int</span>), NULL, 0)) ||
      (sqlo_bind_by_pos(sth, 2, SQLOT_BLOB, &amp;loblp, 0, &amp;ind, 0))
      ) {
    <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
    error_exit(dbh, <span class="stringliteral">"sqlo_bind_by_pos"</span>);
  }

  <span class="comment">/* execute */</span>
  status = <a class="code" href="group__complex.html#ga8">sqlo_execute</a>(sth, 1);

  <span class="keywordflow">if</span> (SQLO_SUCCESS != status) {
    <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
    error_exit(dbh, <span class="stringliteral">"sqlo_execute"</span>);
  }

  <span class="comment">/* write the lob */</span>
  status = <a class="code" href="group__lob.html#ga4">sqlo_lob_write_stream</a>(dbh, loblp, filelen, fp);

  <span class="keywordflow">if</span> (status &lt; 0) {
    <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
    error_exit(dbh, <span class="stringliteral">"sqlo_lob_write_stream"</span>);
  }

  <a class="code" href="group__easy.html#ga15">sqlo_close</a>(sth);
  <a class="code" href="group__lob.html#ga1">sqlo_free_lob_desc</a>(dbh, &amp;loblp);
  fclose(fp);

  <span class="keywordflow">return</span> (1);
}


<span class="comment">/* $Id: ex14.c 286 2004-06-15 10:15:52Z kpoitschke $ */</span>
</pre></div></dd></dl>
<dl compact><dt><b>See also:</b></dt><dd><a class="el" href="group__lob.html#ga2">sqlo_lob_write_buffer</a> </dd></dl>
<dl compact><dt><b>Examples: </b></dt><dd>
<a class="el" href="ex14_8c-example.html#a17">ex14.c</a>.</dl>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Fri Nov 4 16:19:04 2005 for libsqlora8 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.1 </small></address>
</body>
</html>
